name: Required Files Check (Merge to Main)

on:
  push:
    branches:
      - main

jobs:
  validate-required-files:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Run required files checker
        run: python3 check_required_files.py

      - name: Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
           aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
           aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
           aws-region: ${{ secrets.AWS_REGION }}
         
      - name: Create CloudWatch Log Group (if needed)
        run: |
          aws logs create-log-group \
            --log-group-name "${{ secrets.LOG_GROUP_NAME }}" \
            2>/dev/null || echo "Log group already exists"

      - name: Log results to CloudWatch (Prod)
        run: |
          TIMESTAMP=$(date -u "+%Y-%m-%dT%H-%M-%SZ")

          aws logs create-log-stream \
            --log-group-name "${{ secrets.LOG_GROUP_NAME }}" \
            --log-stream-name "$TIMESTAMP"

          aws logs put-log-events \
            --log-group-name "${{ secrets.LOG_GROUP_NAME }}" \
            --log-stream-name "$TIMESTAMP" \
            --log-events "timestamp=$(date +%s)000, message='Required files check completed'"
